!function(t){"use strict";var e={version:"0.0.1"};e.utils={},e.models={},e.charts=[],e.graphs={},e.dispatch=t.dispatch("render_start","render_end"),t.selection.prototype.chart=function(){var t=this.node();return t&&t.__chart__},e.log=function a(t,n,r){function i(){if(!r){var t=Array.prototype.slice.call(arguments);return s.push(t),o?o(t):console.log(t),arguments[arguments.length-1]}}var s=e.log&&e.log.history||[],o=n||t&&alert&&function(){var t,e=Array.prototype.slice.call(arguments);try{t=e.map(function(t){return JSON.stringify(t)}).join(", ")}catch(n){t=e}window.alert(t)},c=i;return c.history=s,c.alert=function(t,n){e.log=a(t,n),t&&s.length&&(n?n(s):alert(s))},c.hide=function(){e.log=a(!1,function(){})},c.kill=function(){e.log=a(!1,!1,!0)},c}(),e.dispatch.on("render_start",function(){e.render.startTime=+new Date}),e.dispatch.on("render_end",function(t){e.render.endTime=+new Date,e.render.time=e.render.endTime-e.render.startTime,e.log(e.charts.length+" charts rendered in "+e.render.time+"ms")}),e.render=function(t,n,r){"function"==typeof t&&(t={build:t,callback:n}),e.render.queue.push(t),e.render.active||r||e.render.start()},e.render.queue=[],e.render.start=function(t){t=t||e.stepSize||1,e.render.active=!0,e.dispatch.render_start(),setTimeout(function n(){var r=e.render.queue.splice(0,t);r.forEach(function(t){var n=t.build();"function"==typeof t.callback&&t.callback(null,n),e.charts.push(n)}),e.render.queue.length?setTimeout(n,0):(e.render.active=!1,e.dispatch.render_end())},0)},e.rebind=function(e,n){var r,i=[];for(r in n)"calc"!==r&&"build"!==r&&i.push(r);t.rebind.apply(t,[e,n].concat(i))},e.expose=function(t,e,n){var r=this;return r[t]="function"==typeof n?function(t){return arguments.length?(e=n(t,e,r),r):e}:function(t){return arguments.length?(e=t,r):e},r},e.extend=function(t){for(var e,n=arguments.length;--n;)for(e in arguments[n])t[e]=arguments[n][e];return t};var n=window.mc;e.noConflict=function(){return window.mc===e&&(window.mc=n),e},"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e:window.mc=e;var r=function(){var t={width:640,height:480};return document.body&&document.body.offsetWidth&&(t.width=document.body.offsetWidth,t.height=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(t.width=document.documentElement.offsetWidth,t.height=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(t.width=window.innerWidth,t.height=window.innerHeight),t};e&&e.utils&&(e.utils.windowSize=r);var i=function(){this._handlers={}};i.prototype.on=function(t,e){var n=t.split("."),r=n[0],i=n[1];return this._handlers[r]||(this._handlers[r]=[]),this._handlers[r].push({namespace:i,callback:e}),this},i.prototype.off=function(t){var e=t.split("."),n=e[0],r=e[1],i=[];if(!this._handlers[n]||!this._handlers[n].length)return null;for(var a in this._handlers[n])this._handlers[n][a].namespace!==r&&(i.push(this._handlers[n][a]),this._handlers.splice(a,1));return i.length?i:null},i.prototype.draw=function(t,e,n,r){this._base=t;var i,a,s,o,c,l;i=this.dataBind.call(this._base,e,n,r),a=i.enter(),s=[{name:"update",selection:i},{name:"enter",selection:a,method:this.insert},{name:"merge",selection:i},{name:"exit",selection:i,method:i.exit}];for(var u in s)if(o=s[u],c=o.selection,"function"==typeof o.method&&(c=o.method.call(c)),!c.empty()){if(l=this._handlers[o.name],l&&l.length)for(var d in l)l[d].callback.call(c,e,n);if(l=this._handlers[o.name+":transition"],l&&l.length){c=c.transition();for(var d in l)l[d].callback.call(c,e,n)}}return i},t.selection.prototype.mlayer=function(t){var e,n=new i(this);if(n.dataBind=t.dataBind,n.insert=t.insert,"events"in t)for(e in t.events)n.on(e,t.events[e]);return this.on=function(){return n.on.apply(n,arguments)},this.off=function(){return n.off.apply(n,arguments)},this.draw=function(){return n.draw.apply(n,arguments)},this},e&&(e.layer=function(t){var e,n=new i;if(n.dataBind=t.dataBind,n.insert=t.insert,"events"in t)for(e in t.events)n.on(e,t.events[e]);return n}),function(t,e,n){function r(){var n={width:640,height:480};return e.body&&e.body.offsetWidth&&(n.width=e.body.offsetWidth,n.height=e.body.offsetHeight),"CSS1Compat"==e.compatMode&&e.documentElement&&e.documentElement.offsetWidth&&(n.width=e.documentElement.offsetWidth,n.height=e.documentElement.offsetHeight),t.innerWidth&&t.innerHeight&&(n.width=t.innerWidth,n.height=t.innerHeight),n}var i={},a=500;n.tooltip=i,i.show=function(n){function i(){switch(f){case"e":l=g[0]-o-m,u=g[1]-c/2,d=l+s(x),h=u+a(x),w>d&&(l=g[0]>w-m?g[0]+m:w-d+l),k>h&&(u=k-h+u),c>k+v.height-h&&(u=k+v.height-h+u-c);break;case"w":l=g[0]+m,u=g[1]-c/2,d=l+s(x),h=u+a(x),o>v.width+w-d&&(l=g[0]-o-m),k>h&&(u=k+5),c>k+v.height-h&&(u=k-c-5);break;case"n":l=g[0]-o/2,u=g[1]+m,d=l+s(x),h=u+a(x),w>d&&(l=w-d+l),o>v.width-d&&(l=l+v.width-d-o),c>k+v.height-h&&(k-h<k+v.height-h-c?(f="s",i()):u=k+v.height-h+u-c);break;default:l=g[0]-o/2,u=g[1]-c-m,d=l+s(x),h=u+a(x),w>d&&(l=w-d+l),o>v.width-d&&(l=l+v.width-d-o),k>h&&(k-h<k+v.height-h-c?(f="n",i()):u=k)}}function a(t){var e=0;do isNaN(t.offsetTop)||(e+=t.offsetTop);while(t=t.offsetParent);return e}function s(t){var e=0;do isNaN(t.offsetLeft)||(e+=t.offsetLeft);while(t=t.offsetParent);return e}var o,c,l,u,d,h,g=n.pos,p=n.content,f=n.gravity||"s",m="undefined"==typeof n.dist?10:n.dist,y=n.parent,_=n.classes,x=e.createElement("div"),b=y,v=r(),k=t.scrollY,w=t.scrollX;return t.innerHeight<e.body.scrollHeight&&(v.width-=16),t.innerWidth<e.body.scrollWidth&&(v.height-=16),(!y||y.tagName.match(/g|svg/i))&&(b=e.getElementsByTagName("body")[0],y=!1),x.innerHTML=p,x.style.left=0,x.style.top=0,x.style.opacity=0,x.className="mc-tooltip "+(_?_:"mc-xy-tooltip")+" mc-tooltip-gravity-"+f,b.appendChild(x),o=parseInt(x.offsetWidth),c=parseInt(x.offsetHeight),i(),x.className="mc-tooltip "+(_?_:"mc-xy-tooltip")+" mc-tooltip-gravity-"+f,x.style.left=l+"px",x.style.top=u+"px",x.style.opacity=1,x.style.position="absolute",x.style.pointerEvents="none",x},i.cleanup=function(){var t,n,r=e.getElementsByClassName("mc-tooltip"),i=[];for(n=0;n<r.length;n++)i.push(r[n]),r[n].style.transitionDelay="0 !important",r[n].style.opacity=0,r[n].className="mc-tooltip-pending-removal";setTimeout(function(){for(;t=i.pop();)t.parentNode.removeChild(t)},a)}}(window,document,e),e.models.axes=function(e){function n(t,e){return t.each(function(t){e=e||{},n.calc.call(this,e,t),n.build.call(this,e,t)}),n}return e=e||{},e.renderBottom=!0,e.renderTop=!1,e.renderLeft=!0,e.renderRight=!1,e.bottomAxis=t.svg.axis(),e.topAxis=t.svg.axis(),e.leftAxis=t.svg.axis(),e.rightAxis=t.svg.axis(),e.bottomLabel_=function(t){return t.xLabel||""},e.topLabel_=function(t){return t.xLabel||""},e.leftLabel_=function(t){return t.yLabel||""},e.rightLabel_=function(t){return t.yLabel||""},e.bottomTickSize_=function(t){return[-t,1]},e.topTickSize_=function(t){return[-t,1]},e.leftTickSize_=function(t){return[-t,1]},e.rightTickSize_=function(t){return[-t,1]},e.bottomTicks_=function(t){return[Math.round(t/80)]},e.topTicks_=function(t){return[Math.round(t/80)]},e.leftTicks_=function(t){return[Math.round(t/40)]},e.rightTicks_=function(t){return[Math.round(t/40)]},n.calc=function(t,e){return n},n.build=function(r,i){var a,s,o,c,l=t.select(this);return a=l.selectAll("g.mc-axes").data([i]),s=a.enter().append("g").attr("class","mc-axes"),c=s.append("g"),o=a.select("g"),c.append("g").attr("class","mc-axis mc-bottomAxis"),c.append("g").attr("class","mc-axis mc-topAxis"),c.append("g").attr("class","mc-axis mc-leftAxis"),c.append("g").attr("class","mc-axis mc-rightAxis"),e.renderBottom&&(e.bottomAxis.scale(e.bottom||r.x).orient("bottom"),e.bottomAxis.tickSize.apply(e.bottomAxis,e.bottomTickSize_(r.height)),e.bottomAxis.ticks.apply(e.bottomAxis,e.bottomTicks_(r.width)),c.select(".mc-bottomAxis").append("g").attr("class","x axis").append("text").attr("class","label").attr("dx",-6).attr("dy",-6).style("text-anchor","end"),o.select(".mc-bottomAxis .label").attr("x",r.width).text(e.bottomLabel_),o.select(".mc-bottomAxis .x.axis").attr("transform","translate(0,"+r.height+")").call(e.bottomAxis)),e.renderTop&&(e.topAxis.scale(e.top||r.x).orient("top"),e.topAxis.tickSize.apply(e.topAxis,e.topTickSize_(r.height)),e.topAxis.ticks.apply(e.topAxis,e.topTicks_(r.width)),c.select(".mc-topAxis").append("g").attr("class","x axis").append("text").attr("class","label").attr("dy","1em").attr("dx","-2em").style("text-anchor","end"),o.select(".mc-topAxis .label").attr("x",r.width).text(e.topLabel_),o.select(".mc-topAxis .x.axis").call(e.topAxis)),e.renderLeft&&(e.leftAxis.scale(e.left||r.y).orient("left"),e.leftAxis.tickSize.apply(e.leftAxis,e.leftTickSize_(r.width)),e.leftAxis.ticks.apply(e.leftAxis,e.leftTicks_(r.height)),c.select(".mc-leftAxis").append("g").attr("class","y axis").append("text").attr("class","label").attr("transform","rotate(90)").attr("dx",6).attr("dy",-6).style("text-anchor","start"),o.select(".mc-leftAxis .label").text(e.leftLabel_),o.select(".mc-leftAxis .y.axis").call(e.leftAxis)),e.renderRight&&(e.rightAxis.scale(e.right||r.y).orient("right"),e.rightAxis.tickSize.apply(e.rightAxis,e.rightTickSize_(r.width)),e.rightAxis.ticks.apply(e.rightAxis,e.rightTicks_(r.height)),c.select(".mc-rightAxis").append("g").attr("class","y axis").append("text").attr("class","label").attr("transform","rotate(-90)").attr("dy",-6).attr("dx",-6).style("text-anchor","end"),o.select(".mc-rightAxis .label").text(e.rightLabel_),o.select(".mc-rightAxis .y.axis").attr("transform","translate("+r.width+",0)").call(e.rightAxis)),n},n.bottomAxis=e.bottomAxis,n.topAxis=e.topAxis,n.leftAxis=e.leftAxis,n.rightAxis=e.rightAxis,n.bottomScale=function(t){return arguments.length?(e.bottom=t,n):e.bottom},n.topScale=function(t){return arguments.length?(e.top=t,n):e.top},n.leftScale=function(t){return arguments.length?(e.left=t,n):e.left},n.rightScale=function(t){return arguments.length?(e.right=t,n):e.right},n.renderBottom=function(t){return arguments.length?(e.renderBottom=t,n):e.renderBottom},n.renderTop=function(t){return arguments.length?(e.renderTop=t,n):e.renderTop},n.renderLeft=function(t){return arguments.length?(e.renderLeft=t,n):e.renderLeft},n.renderRight=function(t){return arguments.length?(e.renderRight=t,n):e.renderRight},n.bottomLabel=function(r){return arguments.length?(e.bottomLabel_=t.functor(r),n):e.bottomLabel_},n.topLabel=function(r){return arguments.length?(e.topLabel_=t.functor(r),n):e.topLabel_},n.leftLabel=function(r){return arguments.length?(e.leftLabel_=t.functor(r),n):e.leftLabel_},n.rightLabel=function(r){return arguments.length?(e.rightLabel_=t.functor(r),n):e.rightLabel_},n.bottomTickSize=function(r){return arguments.length?(e.bottomTickSize_=t.functor(r),n):e.bottomTickSize_},n.topTickSize=function(r){return arguments.length?(e.topTickSize_=t.functor(r),n):e.topTickSize_},n.leftTickSize=function(r){return arguments.length?(e.leftTickSize_=t.functor(r),n):e.leftTickSize_},n.rightTickSize=function(r){return arguments.length?(e.rightTickSize_=t.functor(r),n):e.rightTickSize_},n.bottomTicks=function(r){return arguments.length?(e.bottomTicks_=t.functor(r),n):e.bottomTicks_},n.topTicks=function(r){return arguments.length?(e.topTicks_=t.functor(r),n):e.topTicks_},n.leftTicks=function(r){return arguments.length?(e.leftTicks_=t.functor(r),n):e.leftTicks_},n.rightTicks=function(r){return arguments.length?(e.rightTicks_=t.functor(r),n):e.rightTicks_},n},e.models.bar=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.xyChartBase=e.models.xyChartBase(n),n.name="bar",n.xyChartBase.xScale(t.scale.ordinal()).yForce(0),n.layers=n.layers||{},n.layers.groups=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-group").data(t.series_,t.seriesKey_)},insert:function(){return this.append("g").classed("mc-group",!0)},events:{merge:function(t,e){return this.attr("class",function(t,e){return"mc-group mc-group-"+e}).classed("mc-disabled",function(t){return t.disabled})},"merge:transition":function(t,e){return this.attr("transform",function(t,e){return"translate(0,0)"})},exit:function(t,e){return this.classed("mc-group-exit",!0)},"exit:transition":function(t,e){return this.selectAll(".mc-bar").attr("y",e.y(0)).attr("height",0).remove(),this.remove()}}}),n.layers.bars=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-bar").data(t.values_,t.pointKey_)},insert:function(){return this.append("rect").attr("class",function(t,e){return"mc-bar"})},events:{enter:function(t,e){return this.attr("x",e.x0Calc).attr("y",e.y0Calc).attr("y",function(n){return t.y_.apply(this,arguments)>0?e.y0Calc.apply(this,arguments):e.y0(0)}).attr("width",e.x.rangeBand()).attr("height",function(){return Math.abs(e.y0Calc.apply(this,arguments)-e.y0(0))})},merge:function(t,e){return this.attr("class",function(t,e){return"mc-bar mc-bar-"+e})},"merge:transition":function(t,e){return this.attr("x",e.xCalc).attr("y",function(n){return t.y_.apply(this,arguments)>0?e.yCalc.apply(this,arguments):e.y(0)}).attr("width",e.x.rangeBand()).attr("height",function(){return Math.abs(e.yCalc.apply(this,arguments)-e.y(0))})},exit:function(t,e){return this.classed("mc-bar-exit",!0)},"exit:transition":function(t,e){return this.attr("y",e.y(0)).attr("height",0).remove()}}}),r.calc=function(t,e){return n.xyChartBase.xRangeBands(function(t,e){return[[0,e.width],.1]}),n.xyChartBase.calc.call(this,t,e),this.__chart__.chart=r,this.__chart__.update=function(){return t.container.call(r)},r},r.build=function(t,e){return n.xyChartBase.build.call(this,t,e),t.gEnter.append("g").attr("class","mc-groups"),t.groups=n.layers.groups.draw(t.g.select(".mc-groups"),n,t,e),t.bars=n.layers.bars.draw(t.groups,n,t,e),r},e.rebind(r,n.xyChartBase),r.rebind=function(){return e.rebind(r,n.xyChartBase),r},r},e.models.barGrouped=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.barChart=e.models.bar(n),n.layers.groups.on("merge:transition",function(t,e){return this.attr("transform",function(t,n){return"translate("+n*e.x2.rangeBand()+",0)"})}),n.layers.bars.on("merge:transition",function(t,e){return this.attr("width",e.x2.rangeBand())}),r.calc=function(e,i){return n.barChart.calc.call(this,e,i),e.x2=t.scale.ordinal().domain(n.series_(i).map(n.seriesKey_)).rangeRoundBands([0,e.x.rangeBand()]),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},r},r.build=function(t,e){return n.barChart.build.call(this,t,e),r},r.barChart=n.barChart,e.rebind(r,n.barChart),r},e.models.barStacked=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.barChart=e.models.bar(n),n.layers.bars.on("enter",function(t,e){return this.attr("y",function(t){return e.y0(t.y+t.y0)}).attr("height",function(){return Math.abs(e.y0Calc.apply(this,arguments)-e.y(0))})}).on("merge:transition",function(t,e){return this.attr("y",function(t){return e.y(t.y+t.y0)}).attr("height",function(){return Math.abs(e.yCalc.apply(this,arguments)-e.y(0))})}),r.calc=function(e,i){return e.stack=t.layout.stack().values(n.values_).x(n.x_).y(n.y_),e.stack(i.filter(function(t){return!t.disabled})),n.barChart.yForce([0,t.max(n.series_(i).filter(function(t){return!t.disabled}).map(n.values_).pop().map(function(t){return t.y+t.y0}))]),n.barChart.calc.call(this,e,i),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},r},r.build=function(t,e){return n.barChart.build.call(this,t,e),r},r.barChart=n.barChart,e.rebind(r,n.barChart),r},e.models.chartBase=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}function i(e){e.range&&(e.range=t.functor(e.range)),e.rangePoints&&(e.rangePoints=t.functor(e.rangePoints)),e.rangeBands&&(e.rangeBands=t.functor(e.rangeBands)),e.rangeRoundBands&&(e.rangeRoundBands=t.functor(e.rangeRoundBands)),e.domain&&(e.domain=t.functor(e.domain)),n[e.key+"Scale"]=e.scale||t.scale.linear(),r[e.key+"Scale"]=function(t){return arguments.length?(n[e.key+"Scale"]=t,r):n[e.key+"Scale"]},n[e.key+"_"]=e.accessor||function(t){return t[e.key]},r[e.key]=function(i){return arguments.length?(n[e.key+"_"]=t.functor(i),r):n[e.key+"_"]},n[e.key+"Disable"]=e.disable,r[e.key+"Disable"]=function(t){return arguments.length?(n[e.key+"Disable"]=t,r):n[e.key+"Disable"]},r[e.key+"Range"]=function(n){return arguments.length?(e.range=t.functor(n),r):e.range},r[e.key+"RangePoints"]=function(n){return arguments.length?(e.rangePoints=t.functor(n),r):e.rangePoints},r[e.key+"RangeBands"]=function(n){return arguments.length?(e.rangeBands=t.functor(n),r):e.rangeBands},r[e.key+"RangeRoundBands"]=function(n){return arguments.length?(e.rangeRoundBands=t.functor(n),r):e.rangeRoundBands},r[e.key+"Domain"]=function(n){return arguments.length?(e.domain=t.functor(n),r):e.domain},r[e.key+"Force"]=function(t){return arguments.length?(e.force=t,r):e.force}}return n=n||{},n.name="chartBase",n.margin={top:0,right:0,bottom:0,left:0},n.calcScales=!0,n.width_=function(t,e){return parseInt(t.style("width"))},n.height_=function(t,e){return parseInt(t.style("height"))},n.label_=function(t,e){return t.key},n.series_=function(t){return t},n.values_=function(t,e){return t.values},n.seriesKey_=function(t,e){return t.key||e},n.pointKey_=function(t,e,n){return e},n.id_=function(){return Math.round(899999*Math.random())+1e5},n.dimensions=[],n.dimensions.forEach(i),r.calc=function(e,i){var a,s=this;return e.container=t.select(this),e.width=n.width_(e.container,i)-n.margin.left-n.margin.right,e.height=n.height_(e.container,i)-n.margin.top-n.margin.bottom,n.calcScales&&(a=t.merge(n.series_(i).filter(function(t){return!t.disabled}).map(function(t,e){return n.values_(t,e).map(function(t,r){var i={};return n.dimensions.forEach(function(a){n[a.key+"Disable"]||(i[a.key]=n[a.key+"_"].call(this,t,r,e))}),i})})),n.dimensions.forEach(function(r){n[r.key+"Disable"]||(n[r.key+"Scale"].domain(n[r.key+"Scale"].rangeBands?r.domain&&r.domain(n,e)||"undefined"!=typeof r.force?a.map(function(t){return t[r.key]}).concat(r.force):a.map(function(t){return t[r.key]}):r.domain&&r.domain(n,e)||"undefined"!=typeof r.force?t.extent(t.extent(a,function(t){return t[r.key]}).concat(r.force)):t.extent(a,function(t){return t[r.key]})),r.range&&n[r.key+"Scale"].range(r.range(n,e)),r.rangePoints&&n[r.key+"Scale"].rangePoints.apply(n[r.key+"Scale"],r.rangePoints(n,e)),r.rangeBands&&n[r.key+"Scale"].rangeBands.apply(n[r.key+"Scale"],r.rangeBands(n,e)),r.rangeRoundBands&&n[r.key+"Scale"].rangeRoundBands.apply(n[r.key+"Scale"],r.rangeRoundBands(n,e)))})),this.__chart__=this.__chart__||{},n.dimensions.forEach(function(t){e[t.key]=n[t.key+"Scale"].copy(),e[t.key+"0"]=s.__chart__[t.key]||e[t.key],e[t.key+"Calc"]=function(){return e[t.key](n[t.key+"_"].apply(this,arguments))||0},e[t.key+"0Calc"]=function(){return e[t.key+0](n[t.key+"_"].apply(this,arguments))||0}}),n.dimensions.forEach(function(t){s.__chart__[t.key]=e[t.key]}),r},r.build=function(t,e){return r},r.chartName=function(t){return arguments.length?(n.name=t,r):n.name},r.id=function(e){return arguments.length?(id_=t.functor(e),r):id_},r.margin=function(t){return arguments.length?(n.margin=e.extend(n.margin,t),r):n.margin},r.width=function(e){return arguments.length?(n.width_=t.functor(e),r):n.width_},r.height=function(e){return arguments.length?(n.height_=t.functor(e),r):n.height_},r.calcScales=function(t){return arguments.length?(n.calcScales=t,r):n.calcScales},r.label=function(e){return arguments.length?(n.label_=t.functor(e),r):n.label_},r.series=function(e){return arguments.length?(n.series_=t.functor(e),r):n.series_},r.values=function(e){return arguments.length?(n.values_=t.functor(e),r):n.values_},r.dimension=function(t){return arguments.length?(n.dimensions.push(t),i(t),r):n.dimensions},r},e.models.legend=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.svgBase=e.models.svgBase(n),n.name="legend",n.padding={top:4,right:8,bottom:4,left:8},n.orientation="horizontal",n.horizontalAlign="center",n.verticalAlign="center",n.shape_=t.functor("circle"),n.labelWidth_=100,n.labelHeight_=20,n.svgBase.calcScales(!1),n.layers=n.layers||{},r.calc=function(e,i){n.svgBase.calc.call(this,e,i);var a=i;e.legendElements=a.map(function(t,e){return{series:t,index:e,label:n.label_(t,e),shape:n.shape_(t,e),width:n.labelWidth_(t,e),height:n.labelHeight_(t,e)}}),e.innerWidth=0,e.innerHeight=0;var s=0,o=0,c=n.padding.left,l=n.padding.top;switch(e.legendElements.forEach(function(t){t.column=s,t.row=o,t.left=c,t.top=l,"horizontal"===n.orientation?(c+=t.width,s++,e.innerHeight<l+t.height+n.padding.bottom&&(e.innerHeight=l+t.height+n.padding.bottom),c+n.padding.right>e.width?(s=1,o++,c=t.width,l+=t.height,t.row=o,t.column=0,t.top=l,t.left=n.padding.left):c+n.padding.right>e.innerWidth&&(e.innerWidth=c+n.padding.right)):(l+=t.height,o++,e.innerWidth<c+t.width+n.padding.right&&(e.innerWidth=c+t.width+n.padding.right),l+n.padding.bottom>e.height?(s++,o=1,c+=t.width,l=t.height,t.row=0,t.column=s,t.top=n.padding.top,t.left=c):l+n.padding.bottom>e.innerHeight&&(e.innerHeight=l+n.padding.bottom))}),n.horizontalAlign){case"center":e.leftOffset=parseInt((e.width-e.innerWidth)/2);break;case"right":e.leftOffset=e.width-e.innerWidth;break;default:e.leftOffset=0}switch(n.verticalAlign){case"center":e.topOffset=parseInt((e.height-e.innerHeight)/2);break;case"bottom":e.topOffset=e.height-e.innerHeight;break;default:e.topOffset=0}return e.dispatch=this.__chart__.dispatch||t.dispatch("click","dblclick","mouseover","mouseout"),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},this.__chart__.dispatch=e.dispatch,r},r.build=function(e,i){n.svgBase.build.call(this,e,i),e.gEnter.append("g").attr("class","mc-background"),e.gEnter.append("g").attr("class","mc-legendElements").attr("transform",function(t){return"translate("+e.leftOffset+","+e.topOffset+")"}),e.gEnter.select(".mc-background").append("rect"),e.g.select(".mc-background rect").transition().attr("x",e.leftOffset).attr("y",e.topOffset).attr("width",e.innerWidth).attr("height",e.innerHeight),e.g.select(".mc-legendElements").transition().attr("transform",function(t){return"translate("+e.leftOffset+","+e.topOffset+")"});var a=e.g.select(".mc-legendElements").selectAll(".mc-legendElement").data(e.legendElements),s=a.enter().append("g").attr("class",function(t,e){return"mc-legendElement mc-legendElement-"+e+" mc-group-"+e}).attr("transform",function(t){return"translate("+t.left+","+t.top+")"}).on("click",e.dispatch.click).on("dblclick",e.dispatch.dblclick).on("mouseover",e.dispatch.mouseover).on("mouseout",e.dispatch.mouseout);return s.append("path"),s.append("text"),a.classed("mc-disabled",function(t){return t.series.disabled}),a.transition().attr("transform",function(t){return"translate("+t.left+","+t.top+")"}),a.select("path").attr("transform",function(t){return"translate(7,"+t.height/2+")"}).attr("d",function(e){return t.svg.symbol().type(e.shape).apply(this,arguments)}),a.select("text").attr("dy","1em").attr("dx","1em").text(function(t){return t.label}),a.exit().classed("mc-legendElement-exit",!0).remove(),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},r},e.rebind(r,n.svgBase),r.legendPadding=function(t){return arguments.length?(n.padding=e.extend(n.padding,t),r):n.padding},r.legendOrientation=function(t){return arguments.length?("horizontal"!==t&&"vertical"!==t&&(t="horizontal"),n.orientation=t,r):n.orientation},r.legendHorizontalAlign=function(t){return arguments.length?(-1===["left","center","right"].indexOf(t)&&(t="center"),n.horizontalAlign=t,r):n.horizontalAlign},r.legendVerticalAlign=function(t){return arguments.length?(-1===["top","center","bottom"].indexOf(t)&&(t="center"),n.verticalAlign=t,r):n.verticalAlign},r.legendShape=function(e){return arguments.length?(n.shape_=t.functor(e),r):n.shape_},r.legendLabelWidth=function(e){return arguments.length?(n.labelWidth_=t.functor(e),r):n.labelWidth_},r.legendLabelHeight=function(e){return arguments.length?(n.labelHeight_=t.functor(e),r):n.labelHeight_},r},e.models.line=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.xyChartBase=e.models.xyChartBase(n),n.name="line",n.defined_=function(t){return!t.notDefined},n.layers=n.layers||{},n.layers.groups=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-group").data(t.series_,t.seriesKey_)},insert:function(){return this.append("g").classed("mc-group",!0)},events:{merge:function(t,e){return this.attr("class",function(t,e){return"mc-group mc-group-"+e}).classed("mc-disabled",function(t){return t.disabled})},exit:function(t,e){return this.classed("mc-group-exit",!0)},"exit:transition":function(t,e){return this.remove()}}}),n.layers.lines=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-path").data(function(){return[t.values_.apply(this,arguments)]})},insert:function(){return this.append("path").attr("class",function(t,e){return"mc-path"})},events:{enter:function(e,n){return this.attr("d",t.svg.line().defined(e.defined_).x(n.x0Calc).y(n.y0Calc))},merge:function(t,e){return this.attr("class",function(t,e){return"mc-path mc-path-"+e})},"merge:transition":function(e,n){return this.attr("d",t.svg.line().defined(e.defined_).x(n.xCalc).y(n.yCalc))},exit:function(t,e){return this.classed("mc-path-exit",!0)},"exit:transition":function(e,n){return this.attr("d",t.svg.line().defined(e.defined_).x(n.xCalc).y(n.yCalc)).remove()}}}),r.calc=function(t,e){return n.xyChartBase.calc.call(this,t,e),this.__chart__.chart=r,this.__chart__.update=function(){return t.container.call(r)},r},r.build=function(t,e){return n.xyChartBase.build.call(this,t,e),t.gEnter.append("g").attr("class","mc-groups"),t.groups=n.layers.groups.draw(t.g.select(".mc-groups"),n,t,e),t.lines=n.layers.lines.draw(t.groups,n,t,e),r},e.rebind(r,n.xyChartBase),r.defined=function(t){return arguments.length?(n.defined_=t,r):n.defined_},r.rebind=function(){return e.rebind(r,n.xyChartBase),r},r},e.models.scatter=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.xyChartBase=e.models.xyChartBase(n),n.name="scatter",n.renderVoronoi=!1,n.useTooltip=!0,n.tooltipParent=null,n.tooltip_=function(e,r,i){var a=t.format(",.2r");return'<span class="mc-tooltip-x">'+a(n.x_.apply(this,arguments))+':&nbsp;</span><span class="mc-tooltip-y">'+a(n.y_.apply(this,arguments))+"</span>"},n.xyChartBase.dimension({key:"size",range:[4,16]}),n.layers=n.layers||{},n.layers.groups=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-group").data(t.series_,t.seriesKey_)},insert:function(){return this.append("g").classed("mc-group",!0)},events:{enter:function(t,e){return this},merge:function(t,e){return this.attr("class",function(t,e){return"mc-group mc-group-"+e}).classed("mc-disabled",function(t){return t.disabled})},"merge:transition":function(t,e){return this},exit:function(t,e){return this.classed("mc-group-exit",!0)},"exit:transition":function(t,e){return this.remove()}}}),n.layers.points=e.layer({dataBind:function(t,e,n){return this.selectAll(".mc-point").data(t.values_,t.pointKey_)},insert:function(){return this.append("circle").classed("mc-point",!0)},events:{enter:function(t,e){return this.attr("r",e.size0Calc).attr("cx",e.x0Calc).attr("cy",e.y0Calc).on("click",e.dispatch.click).on("dblclick",e.dispatch.dblclick).on("mouseover",e.dispatch.mouseover).on("mouseout",e.dispatch.mouseout)},merge:function(t,e){return this.attr("class",function(t,e){return"mc-point mc-point-"+e})},"merge:transition":function(t,e){return this.attr("r",e.sizeCalc).attr("cx",e.xCalc).attr("cy",e.yCalc)},exit:function(t,e){return this.classed("mc-point-exit",!0)},"exit:transition":function(t,e){return this.attr("r",e.sizeCalc).attr("cx",e.xCalc).attr("cy",e.yCalc).remove()}}}),r.calc=function(e,i){return n.xyChartBase.calc.call(this,e,i),e.dispatch=this.__chart__.dispatch||t.dispatch("click","dblclick","mouseover","mouseout"),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},this.__chart__.dispatch=e.dispatch,r},r.build=function(t,i){function a(e,n,r){var i=t.g.select(".mc-group-"+r+" .mc-point-"+n);t.dispatch.click.apply(i.node(),arguments)}function s(e,n,r){var i=t.g.select(".mc-group-"+r+" .mc-point-"+n);t.dispatch.dblclick.apply(i.node(),arguments)}function o(e,n,r){var i=t.g.select(".mc-group-"+r+" .mc-point-"+n);l(),d(),u.apply(this,arguments),i.classed("mc-hover",!0),t.dispatch.mouseover.apply(i.node(),arguments)}function c(e,n,r){var i=t.g.select(".mc-group-"+r+" .mc-point-"+n);l(),d(),t.dispatch.mouseout.apply(i.node(),arguments)}function l(){t.g.select(".mc-point.mc-hover").classed("mc-hover",!1)}function u(r,i,a){if(n.useTooltip){var s=t.xCalc.apply(this,arguments)+n.margin.left,o=t.yCalc.apply(this,arguments)+n.margin.top;e.tooltip.show({pos:[s,o],content:n.tooltip_.apply(this,arguments),gravity:"s",dist:20,parent:n.tooltipParent||t.container.node().parentNode})}}function d(){n.useTooltip&&e.tooltip.cleanup()}function h(e){e.series.hover=!0,t.g.select(".mc-groups").classed("mc-groupHover",!0),t.groups.classed("mc-hover",function(t){return t.hover})}function g(e){e.series.hover=!1,t.g.select(".mc-groups").classed("mc-groupHover",!1),t.groups.classed("mc-hover",!1)}return n.xyChartBase.build.call(this,t,i),t.gEnter.append("g").attr("class","mc-groups"),t.gEnter.append("g").attr("class","mc-voronoi-wrap"),t.groups=n.layers.groups.draw(t.g.select(".mc-groups"),n,t,i),t.points=n.layers.points.draw(t.groups,n,t,i),n.renderVoronoi&&(n.voronoi.series(n.series_).values(n.values_).x(n.x_).y(n.y_).xScale(t.x).yScale(t.y).width(t.width).height(t.height),t.voronoiWrap=t.g.select(".mc-voronoi-wrap"),t.voronoiWrap.call(n.voronoi),t.voronoiWrap.chart().dispatch.on("click.pointClick",a),t.voronoiWrap.chart().dispatch.on("dblclick.pointDblClick",s),t.voronoiWrap.chart().dispatch.on("mouseover.pointMouseover",o),t.voronoiWrap.chart().dispatch.on("mouseout.pointMouseout",c)),n.renderLegend&&(t.legendWrap.chart().dispatch.on("mouseover.hoverSeries",h),t.legendWrap.chart().dispatch.on("mouseout.unhoverSeries",g)),r},e.rebind(r,n.xyChartBase),r.renderVoronoi=function(i){return arguments.length?(n.renderVoronoi=i,i&&(n.voronoi=e.models.voronoi(),n.voronoi.calcScales(!1).clipTiles(!0).renderLegend(!1).renderAxes(!1),t.rebind(r,n.voronoi,"clipRadius","clipTiles"),r.voronoi=n.voronoi),r):n.renderVoronoi},r.tooltip=function(t){return arguments.length?(n.tooltip_=t,r):n.tooltip_},r.useTooltip=function(t){return arguments.length?(n.useTooltip=t,r):n.useTooltip},r.tooltipParent=function(t){return arguments.length?(n.tooltipParent=t,r):n.tooltipParent},r.rebind=function(){return e.rebind(r,n.xyChartBase),r},r},e.models.svgBase=function(t){function n(t,e){return t.each(function(t){e=e||{},n.calc.call(this,e,t),n.build.call(this,e,t)}),n}return t=t||{},t.chartBase=e.models.chartBase(t),t.name="svgBase",n.calc=function(e,r){return t.chartBase.calc.call(this,e,r),n},n.build=function(e,r){return t.chartBase.build.call(this,e,r),e.wrap=e.container.selectAll("g.mc-"+t.name).data([r]),e.wrapEnter=e.wrap.enter().append("g").attr("class","mc-"+t.name),e.defsEnter=e.wrapEnter.append("defs"),e.defs=e.wrap.select("defs"),e.gEnter=e.wrapEnter.append("g"),e.g=e.wrap.select("g"),e.wrap.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),n},e.rebind(n,t.chartBase),n},e.models.voronoi=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.xyChartBase=e.models.xyChartBase(n),n.name="voronoi",n.clipTiles=!1,n.active_=function(t){return!t.notActive},n.clipRadius_=function(){return 25},n.layers=n.layers||{},
n.layers.tiles=e.layer({dataBind:function(t,e,n){return this.selectAll("path").data(n)},insert:function(){return this.append("path").classed("mc-tile",!0)},events:{enter:function(t,e){return this.on("click",function(t){e.dispatch.click(t.point,t.pointIndex,t.seriesIndex,{point:t.point,series:t.series,pos:[e.xCalc.call(this,t.point,t.pointIndex,t.seriesIndex),e.yCalc.call(this,t.point,t.pointIndex,t.seriesIndex)],seriesIndex:t.seriesIndex,pointIndex:t.pointIndex})}).on("dblclick",function(t){e.dispatch.dblclick(t.point,t.pointIndex,t.seriesIndex,{point:t.point,series:t.series,pos:[e.xCalc.call(this,t.point,t.pointIndex,t.seriesIndex),e.yCalc.call(this,t.point,t.pointIndex,t.seriesIndex)],seriesIndex:t.seriesIndex,pointIndex:t.pointIndex})}).on("mouseover",function(t){e.dispatch.mouseover(t.point,t.pointIndex,t.seriesIndex,{point:t.point,series:t.series,pos:[e.xCalc.call(this,t.point,t.pointIndex,t.seriesIndex),e.yCalc.call(this,t.point,t.pointIndex,t.seriesIndex)],seriesIndex:t.seriesIndex,pointIndex:t.pointIndex})}).on("mouseout",function(t){e.dispatch.mouseout(t.point,t.pointIndex,t.seriesIndex,{point:t.point,series:t.series,seriesIndex:t.seriesIndex,pointIndex:t.pointIndex})})},merge:function(t,e){return this.attr("class",function(t,e){return"mc-tile mc-tile-"+e+" mc-group-"+t.seriesIndex}).attr("d",function(t){return 0===t.data.length?"":"M"+t.data.join("L")+"Z"})},exit:function(t,e){return this.remove()}}}),n.layers.tileClips=e.layer({dataBind:function(t,e,n){return this.selectAll("circle").data(e.vertices)},insert:function(){return this.append("circle")},events:{enter:function(t,e){return this.attr("r",t.clipRadius_)},merge:function(t,e){return this.attr("cx",function(t){return t[0]}).attr("cy",function(t){return t[1]})},exit:function(t,e){return this.remove()}}}),r.calc=function(e,i){n.xyChartBase.calc.call(this,e,i),e.dispatch=this.__chart__.dispatch||t.dispatch("click","dblclick","mouseover","mouseout"),e.id=this.__chart__.id||n.id_.call(this,i);var a=n.series_(i);return e.vertices=t.merge(n.series_(i).map(function(t,r){return t.disabled?!1:n.values_(t,r).map(function(t,i){var a=n.x_.call(this,t,i,r)+1e-10*Math.random(),s=n.y_.call(this,t,i,r)+1e-10*Math.random();return[e.x(a),e.y(s),t,i,r]}).filter(function(t){return n.active_(t[2],t[3])})}).filter(function(t){return!!t})),e.bounds=t.geom.polygon([[-10,-10],[-10,e.height+10],[e.width+10,e.height+10],[e.width+10,-10]]),e.voronoi=t.geom.voronoi(e.vertices).map(function(t,r){var i=e.vertices[r][4],s=e.vertices[r][3],o=a[i],c=n.values_(o,i)[s];return{data:e.bounds.clip(t),seriesIndex:i,series:o,pointIndex:s,point:c}}),this.__chart__.chart=r,this.__chart__.update=function(){return e.container.call(r)},this.__chart__.dispatch=e.dispatch,this.__chart__.id=e.id,r},r.build=function(t,e){return n.xyChartBase.build.call(this,t,e),t.gEnter.append("g").attr("class","mc-tiles"),n.clipTiles&&(t.wrap.select("defs").selectAll(".mc-tile-clips").data([t.id]).enter().append("clipPath").attr("class","mc-tile-clips").attr("id","mc-tiles-clip-"+t.id),t.tileClips=n.layers.tileClips.draw(t.wrap.select("#mc-tiles-clip-"+t.id),n,t,e),t.g.select(".mc-tiles").attr("clip-path","url(#mc-tiles-clip-"+t.id+")")),t.tiles=n.layers.tiles.draw(t.g.select(".mc-tiles"),n,t,t.voronoi),r},e.rebind(r,n.xyChartBase),r.clipTiles=function(t){return arguments.length?(n.clipTiles=t,r):n.clipTiles},r.clipRadius=function(t){return arguments.length?(n.clipRadius_=t,r):n.clipRadius_},r},e.models.xyBase=function(t){function n(t,e){return t.each(function(t){e=e||{},n.calc.call(this,e,t),n.build.call(this,e,t)}),n}return t=t||{},t.svgBase=e.models.svgBase(t),t.name="xyBase",t.svgBase.dimension({key:"x",range:function(t,e){return[0,e.width]}}).dimension({key:"y",range:function(t,e){return[e.height,0]}}),e.rebind(t.svgBase,t.chartBase),n.calc=function(e,r){return t.svgBase.calc.call(this,e,r),n},n.build=function(e,r){return t.svgBase.build.call(this,e,r),n},e.rebind(n,t.svgBase),n},e.models.xyChartBase=function(n){function r(t,e){return t.each(function(t){e=e||{},r.calc.call(this,e,t),r.build.call(this,e,t)}),r}return n=n||{},n.xyBase=e.models.xyBase(n),n.name="xyChartBase",n.renderLegend=!1,n.renderAxes=!1,r.calc=function(t,e){return n.xyBase.calc.call(this,t,e),r},r.build=function(t,e){function i(e){e.series.disabled=!e.series.disabled,t.container.chart().update()}return n.xyBase.build.call(this,t,e),t.gEnter.append("g").attr("class","mc-axes-wrap"),t.gEnter.append("g").attr("class","mc-legend-wrap"),n.renderAxes&&(t.axesWrap=t.g.select(".mc-axes-wrap"),n.axes(t.axesWrap,t)),n.renderLegend&&(t.legendWrap=t.g.select(".mc-legend-wrap").attr("transform","translate(0,-20)"),n.legend.width(t.width).height(20),n.legend(t.legendWrap),t.legendWrap.chart().dispatch.on("click.toggleDisabled",i)),r},e.rebind(r,n.xyBase),r.renderLegend=function(i){return arguments.length?(n.renderLegend=i,i&&(n.legend=e.models.legend(),n.legend.legendLabelWidth(85).legendLabelHeight(20).legendHorizontalAlign("right"),t.rebind(r,n.legend,"legendOrientation","legendHorizontalAlign","legendVerticalAlign","legendShape","legendLabelWidth","legendLabelHeight")),r):n.renderLegend},r.renderAxes=function(t){return arguments.length?(n.renderAxes=t,t&&(n.axes=e.models.axes(n),e.rebind(r,n.axes)),r):n.renderAxes},r}}(d3);